<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="src/css/FONT__MASTER.min.css">
        <link rel="stylesheet" href="src/css/ROOT.main.min.css">
        <link rel="stylesheet" href="src/css/ROOT.settings.min.css">
        <link rel="stylesheet" href="src/css/ROOT.components.min.css">
        <link rel="stylesheet" href="src/css/ROOT.VIEW.asset.min.css">
        <link rel="stylesheet" href="src/css/ROOT.VIEW.edit.min.css">
        <link rel="stylesheet" href="src/css/ROOT.VIEW.start.min.css">
        <link rel="stylesheet" href="src/css/ROOT.VIEW.store.min.css">

        <link href="src/css/themes/prism.css" rel="stylesheet">
        <script>
            // STORAGE / DEFAULTS
            const HTML_ROOT_STRUCTURES = require('./src/templates/html.structures.json')
            const CSS_ROOT_STYLES = require('./src/templates/css.styles.json')

            // GLOBAL REQUIREMENTS
            const $ = require('jquery')
            const _ = require('lodash')
            const fs = require('fs')
            const Vue = require('vue/dist/vue.min')
            const Vuex = require('vuex')
            const path = require('path')
            const emmet = require('emmet')
            const Fuse = require('fuse.js')
            const anime = require('animejs')
            const pretty = require('pretty')
            const Prism = require('prismjs')
            const html2json = require('html2json').html2json
            const Toast = require('./src/js/modules/toast.js')
            const settings = require('electron-settings')
            const Mousetrap = require('mousetrap')
            const colorConvert = require('color-convert')
            const remote = require('electron').remote
            const { dialog } = require('electron').remote
            const { ipcRenderer } = require('electron')
        </script>
    </head>
    <body>
        <div id="app">




            <header class="titlebar">
                <div class="drag-area">
                    <div class="window-title">
                        <div class="tab-container">
                            <div class="tab" v-for="(taab, id) in TABS" :class="{'active' : id == ACTIVE_TAB}">
                                <div class="change-dot" :class="{'active' : taab.CHANGED}"></div>
                                <span class="title" :onclick="'selectTab('+id+')'">{{taab.NAME}}</span>
                                <div class="close" :onclick="'closeTab('+id+')'">&#61782;</div>
                            </div>
                            <div class="create" onclick="newTab()">&#62485;</div>
                        </div>
                    </div>
                    <div class="window-controls">
                        <div class="tb-button" id="min-button">
                            <div class="icon">&#62324;</div>
                        </div>
                        <div class="tb-button" id="max-button">
                            <div class="icon">&#61745;</div>
                        </div>
                        <div class="tb-button" id="restore-button">
                            <div class="icon">&#61751;</div>
                        </div>
                        <div class="tb-button" id="close-button">
                            <div class="icon">&#61782;</div>
                        </div>
                    </div>
                </div>
            </header>

            <div id="preloader">
                <div class="logo"></div>
                <svg class="spinner" viewBox="0 0 50 50">
                    <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
                </svg>
            </div>








            <div class="view" id="home-view" v-show="TAB.VIEW == 'VIEW:HOME'">
                <div class="home-open-settings" @click="GENERAL_UI.settings = true">
                    <div class="icon">&#62611;</div>
                </div>
                <div class="header">
                    <div class="view-selector" @click="TAB.VIEW = 'VIEW:LAYOUT_EDITOR'">
                        <div class="image-container">
                            <div class="image image-layout-editor"></div>
                        </div>
                        <div class="label">Layout Editor (1)</div>
                    </div>
                    <div class="view-selector" @click="TAB.VIEW = 'VIEW:LAYOUT_CREATOR'">
                        <div class="image-container">
                            <div class="image image-layout-creator"></div>
                        </div>
                        <div class="label">Layout Creator (2)</div>
                    </div>
                    <div class="view-selector" @click="TAB.VIEW = 'VIEW:PROJECT_MANAGER'">
                        <div class="image-container">
                            <div class="image image-project-manager"></div>
                        </div>
                        <div class="label">Project Manager (3)</div>
                    </div>
                    <div class="view-selector" @click="TAB.VIEW = 'VIEW:ASSET_STORE'">
                        <div class="image-container">
                            <div class="image image-asset-store"></div>
                        </div>
                        <div class="label">Open Market (4)</div>
                    </div>
                </div>
            </div>





            <div class="view" id="layout-editor-view" v-show="TAB.VIEW == 'VIEW:LAYOUT_EDITOR'">

                <div class="option-panel">
                    <div class="icon-button unimportant" title="Leave to overview" @click="TAB.VIEW = 'VIEW:HOME'">&#62828;</div>
                    <div class="button" onclick="generateCode()">
                        <div class="icon">&#64567;</div> Generate Code
                    </div>
                    <div class="account">
                        <div class="sign-in" v-show="!USER.online">
                            <div class="text">Sign In</div>
                            <div class="image">
                                <div class="icon">&#64305;</div>
                            </div>
                        </div>
                        <div class="online" v-show="USER.online">
                            <div class="text">{{USER.displayName}}</div>    
                            <div class="image">
                                <img :src="USER.displayImage" alt="">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="structure-panel">
                    <focus-indicator :when="TAB.FOCUSED_PANEL" equals="STRUCTURE"></focus-indicator>

                    <div class="tree-container">
                        <structure-tree v-for="(child, id) in TAB.DOCUMENT.HTML.children" :focus="TAB.FOCUSED_HTML" :trace="id" :attributes="child.attributes" :label="child.label" :children="child.children"></structure-tree>
                    </div>

                    <div class="structure-add-panel" v-show="TAB.UI.structureAdd">
                        <focus-indicator :when="TAB.FOCUSED_PANEL" equals="STRUCTURE_ADD|STRUCTURE_ADD_SEARCH"></focus-indicator>
                        
                        <div class="close" onclick="closeStructureAdd()">
                            <div class="key">esc</div>
                        </div>

                        <div class="direction-indicator" :class="TAB.UI_DATA.structureAddDirection">
                            <div class="dot"></div>
                        </div>

                        <label class="search">
                            <input  class="input mousetrap"
                                    type="text"
                                    ref="structureSearch"
                                    tabindex="-1"
                                    placeholder="Search tags or presets"
                                    v-model="TAB.UI_DATA.structureAddSearch"
                                    onfocus="focusStructureAddSearch()"
                                    onblur="blurStructureAddSearch()"
                                    onkeyup="updateStructureAddSearch()"
                                    onkeydown="disableInputArrowKeys(event)">
        
                            <div class="info" :class="{'active' : TAB.FOCUSED_PANEL == 'STRUCTURE_ADD'}">
                                <div class="icon">&#62225;</div>
                                <div class="key">enter</div>
                            </div>
                        </label>
                        <div class="autocomplete" v-show="TAB.UI_DATA.structureAddSearch != ''">
                            <div class="empty" v-show="TAB.UI_DATA.structureAddSearchItems.length == 0">No matches found</div>
                            <div class="item" v-for="(structure, id) in TAB.UI_DATA.structureAddSearchItems" :class="{'selected' : id == TAB.UI_DATA.structureAddSearchSelected}">
                                <div class="type">{{structure.type}}:</div>
                                <div class="label">{{structure.name}}</div>
                            </div>
                        </div>
                        <div class="suggestions" v-show="TAB.UI_DATA.structureAddSearch == ''">
                            <div class="box">
                                <div class="icon">&#62372;</div>
                                <div class="tag">DIV</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62375;</div>
                                <div class="tag">SPAN</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62378;</div>
                                <div class="tag">A</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62381;</div>
                                <div class="tag">INPUT</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62384;</div>
                                <div class="tag">B</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62387;</div>
                                <div class="tag">HTML*</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62390;</div>
                                <div class="tag">INPUT</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62393;</div>
                                <div class="tag">B</div>
                            </div>
                            <div class="box">
                                <div class="icon">&#62396;</div>
                                <div class="tag">HTML*</div>
                            </div>
                        </div>
                    </div>

                    <div class="button-container">
                        <div class="btn" onclick="removeStructureRemove(TAB().FOCUSED_HTML)">
                            <div class="icon">&#64120;</div>
                            <div class="key">del</div>
                        </div>
                        <div class="btn">
                            <div class="icon">&#62443;</div>
                            <div class="key">ctrl + enter</div>
                        </div>
                        <div class="btn" onclick="openStructureAdd(TAB().FOCUSED_HTML, 'INTO')">
                            <div class="icon">&#62485;</div>
                            <div class="key">enter</div>
                        </div>
                    </div>
                </div>

                <div class="styling-panel">
                    <focus-indicator :when="TAB.FOCUSED_PANEL" equals="STYLE"></focus-indicator>

                    <div class="tree-container">
                        <style-tree v-for="(child, id) in TAB.DOCUMENT.CSS.children" :focus="TAB.FOCUSED_CSS" :trace="id" :properties="child.properties" :label="child.label" :children="child.children"></style-tree>
                    </div>

                    <div class="style-add-panel" v-show="TAB.UI.styleAdd">
                        <focus-indicator :when="TAB.FOCUSED_PANEL" equals="STYLE_ADD"></focus-indicator>

                        <div class="close" onclick="closeStyleAdd()">
                            <div class="key">esc</div>
                        </div>

                        <label class="input style-name">
                            <input  class="input-field mousetrap"
                                    type="text"
                                    ref="styleInput"
                                    tabindex="-1"
                                    placeholder="Selector"
                                    v-model="TAB.UI_DATA.styleAddInput"
                                    onkeydown="disableInputArrowKeys(event)">
    
                            <div class="info" :class="{'active' : TAB.FOCUSED_PANEL == 'STYLE_ADD'}">
                                <div class="icon">&#62225;</div>
                                <div class="key">enter</div>
                            </div>
                        </label>

                        <div class="direction-indicator" :class="TAB.UI_DATA.styleAddDirection">
                            <div class="dot"></div>
                        </div>

                        <div class="button">Add Selector</div>
                    </div>

                    <div class="style-prop-add-panel" v-show="TAB.UI.stylePropAdd">
                        <focus-indicator :when="TAB.FOCUSED_PANEL" equals="STYLE_PROP_ADD"></focus-indicator>

                        <div class="close" onclick="closeStylePropAdd()">
                            <div class="key">esc</div>
                        </div>

                        <label class="input prop-name">
                            <input  class="input-field mousetrap"
                                    type="text"
                                    ref="stylePropName"
                                    tabindex="-1"
                                    placeholder="Property"
                                    v-model="TAB.UI_DATA.stylePropAddName"
                                    onfocus="addStylePropSetStep(0)"
                                    onkeydown="disableInputArrowKeys(event)">
                        </label>

                        <label class="input prop-value">
                            <input  class="input-field mousetrap"
                                    type="text"
                                    ref="stylePropValue"
                                    tabindex="-1"
                                    placeholder="Value"
                                    v-model="TAB.UI_DATA.stylePropAddValue"
                                    onfocus="addStylePropSetStep(1)"
                                    onkeydown="disableInputArrowKeys(event)">
                        </label>

                        <div class="button" onclick="addStylePropAddHELPER()">Add Property</div>
                    </div>
                    
                    <div class="button-container">
                        <div class="btn" onclick="removeStyleRemove(TAB().FOCUSED_CSS)">
                            <div class="icon">&#64120;</div>
                            <div class="key">del</div>
                        </div>
                        <div class="btn">
                            <div class="icon">&#62443;</div>
                            <div class="key">ctrl + enter</div>
                        </div>
                        <div class="btn" onclick="openStyleAdd(TAB().FOCUSED_CSS, 'INTO')">
                            <div class="icon">&#62485;</div>
                            <div class="key">enter</div>
                        </div>
                    </div>
                </div>

                <div class="workspace">
                    <div class="controls">
                        <div class="control-input">
                            <div class="icon">&#63565;</div>
                            <input class="input" tabindex="-1" min="0" max="9999" maxlength="4" type="number" v-model="TAB.VIEWPORT.X">
                        </div>
                        <div class="control-input">
                            <div class="icon">&#63566;</div>
                            <input class="input" tabindex="-1" min="0" max="9999" maxlength="4" type="number" v-model="TAB.VIEWPORT.Y">
                        </div>
                        <div class="control-icon-btn" onclick="rotateCoupledViewport()">&#62581;</div>
                        <div class="control-icon-btn" onclick="decoupleViewport()" :class="{'active' : TAB.VIEWPORT.DECOUPLED}">&#61516;</div>
                    </div>

                    <div class="center">
                        <div class="decoupled-viewport" v-show="TAB.VIEWPORT.DECOUPLED">
                            <div class="icon">&#63880;</div>
                            <div class="text">
                                The Viewport is <strong>decoupled</strong> and<br>shown in a seperate window.
                            </div>
                        </div>

                        <viewport :content="TAB.VIEWPORT.CONTENT" :x="TAB.VIEWPORT.X" :y="TAB.VIEWPORT.Y" @update:x="TAB.VIEWPORT.X = $event" @update:y="TAB.VIEWPORT.Y = $event" v-show="!TAB.VIEWPORT.DECOUPLED"></viewport>
                    </div>
                </div>

                <div class="status-panel">
                    <div class="savepath" :title="TAB.SAVE_PATH" onclick="setSavePath(TAB())">
                        <div class="icon">&#63343;</div>
                        <div class="label" v-show="savePathName">{{savePathName}}</div>
                        <div class="label" v-show="!savePathName">Set file location</div>
                    </div>
                </div>
            </div>





            <div class="view" id="layout-creator-view" v-show="TAB.VIEW == 'VIEW:LAYOUT_CREATOR'">
                
            </div>





            <div class="view" id="project-manager-view" v-show="TAB.VIEW == 'VIEW:PROJECT_MANAGER'">
                
            </div>





            <div class="view" id="asset-store-view" v-show="TAB.VIEW == 'VIEW:ASSET_STORE'">
                
            </div>





            <colorpicker v-show="false"></colorpicker>

            <div class="popup-bg" :class="{'active' : TAB.UI.code}">
                <div class="popup-holder settings-holder">
                    <div class="popup-header settings-header">
                        Generated Code:
                        <div class="close-ui" @click="TAB.UI.code = false">&#61782;</div>
                    </div>
                    <div class="popup-content generated-code-container">
                        <pre class="html-container" v-html="TAB.UI_DATA.html"></pre>
                        <pre class="css-container" v-html="TAB.UI_DATA.css"></pre>
                    </div>
                </div>
            </div>




            <div class="popup-bg settings-bg" :class="{'active' : GENERAL_UI.settings}">
                <div class="popup-holder settings-holder">
                    <div class="popup-header settings-header">
                        Settings
                        <div class="close-ui" @click="GENERAL_UI.settings = false">&#61782;</div>
                    </div>

                    <div class="settings-categories">
                        <div class="category" :class="{'active' : GENERAL_UI.activeSetting == 'ACCOUNT'}" @click="GENERAL_UI.activeSetting = 'ACCOUNT'"><div class="icon">&#63024;</div> Account</div>
                        <div class="category" :class="{'active' : GENERAL_UI.activeSetting == 'INFO'}" @click="GENERAL_UI.activeSetting = 'INFO'"><div class="icon">&#62205;</div> Info</div>
                    </div>

                    <div class="popup-content settings-content" v-show="GENERAL_UI.activeSetting == 'ACCOUNT'">
                        <div class="settings-divider">
                            <div class="info">
                                <h2>Account Settings</h2><br>
                                Pretty empty, huh?
                            </div>
                        </div>
                    </div>

                    <div class="popup-content settings-content" v-show="GENERAL_UI.activeSetting == 'INFO'">
                        <div class="settings-divider">
                            <div class="info">
                                <h2>About this Software</h2><br>
                                Version: <div class="box">{{info.version}}</div><div class="box secondary">{{info.versionName}}</div><br>
                                API-Version: <div class="box">{{info.apiVersion}}</div><br>
                                Node-Version: <div class="box">{{info.nodeVersion}}</div><br>
                                Electron-Version: <div class="box">{{info.electronVersion}}</div><br><br>

                                Release Notes:
                                <div class="button" @click="GENERAL_UI.releaseNote = true">
                                    <div class="icon">&#61635;</div>
                                    Open
                                </div><br><br>
                                <h2>About the developer</h2><br>
                                Developed by <i>Maurice Freuwört Software and Design</i>
                            </div>
                        </div>
                    </div>

                    <div class="popup-footer settings-footer">
                        <div class="button" onclick="applySettings()"><div class="icon">&#61748;</div> Übernehmen</div>
                    </div>
                </div>
            </div>
            



            <div class="popup-bg release-note-bg no-select" :class="{'active' : GENERAL_UI.releaseNote}">
                <div class="popup-holder release-note-holder">
                    <div class="release-image">
                        <span class="title">
                            {{info.versionName}}
                            <span class="version">{{info.version}}</span>
                        </span>
                    </div>
                    <span class="headline">Welcome to VuDesigner!</span>
                    <div class="release-note-container">
                        • Add and remove elements<br>
                    </div>
                    <div class="close-release-note" @click="GENERAL_UI.releaseNote = false">Let's go!</div>
                </div>
            </div>




            <!-- HOLDER FOR ALL TOAST NOTIFICATIONS -->
            <div class="toast-holder"></div>

        </div>
    </body>
    
    <script>
        require('./src/js/events/ipc.events.js')
        require('./src/js/events/keybind.events.js')

        require('./src/js/helper/ui.helper.js')
        require('./src/js/helper/tab.helper.js')
        require('./src/js/helper/misc.helper.js')
        require('./src/js/helper/file.helper.js')
        require('./src/js/helper/render.helper.js')
        require('./src/js/helper/keybind.helper.js')
        require('./src/js/helper/document.helper.js')
        require('./src/js/helper/edit_style.helper.js')
        require('./src/js/helper/edit_structure.helper.js')
        require('./src/js/helper/edit_navigation.helper.js')
    </script>
    <script src="src/js/components/drag-number-input.js"></script>
    <script src="src/js/components/focus-indicator.js"></script>
    <script src="src/js/components/style-property.js"></script>
    <script src="src/js/components/structure-tree.js"></script>
    <script src="src/js/components/colorpicker.js"></script>
    <script src="src/js/components/iconpicker.js"></script>
    <script src="src/js/components/style-tree.js"></script>
    <script src="src/js/components/viewport.js"></script>
    <script src="src/js/app.js"></script>
    <script> ipcRenderer.send('loaded') </script>

    <script src="tests/unit/functioncall.js"></script>
    <script>
        //console.log(emmet.markupAbbreviation('div.*4', {output: {format: false}}))
        //test_validateTrace()
    </script>
</html>